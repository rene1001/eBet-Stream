{% extends 'users/base.html' %}
{% load i18n %} 
{% block title %}{% trans "Profile" %} - eBetStream{% endblock %} 
{% block extra_css %}
<!-- Profile styles are now handled by sport-style.css -->
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row g-4">
    <!-- Profile Section -->
    <div class="col-md-4">
      <div class="card border-0 shadow-lg">
        <div class="sport-profile-header text-center">
          <div class="sport-avatar mb-3">
            <img
              src="{{ user.profile.image.url }}"
              alt="Avatar de {{ user.username }}"
              class="rounded-circle profile-image"
              style="width: 120px; height: 120px; object-fit: cover; position: relative; z-index: 1;"
              loading="lazy"
            />
          </div>
          <h3 class="username-display mb-2">{{ user.username }}</h3>
          <p class="text-white-50 mb-0">
            <i class="bi bi-envelope-at me-2"></i>{{ user.email }}
          </p>
        </div>
        
        <!-- Balance Card -->
        <div class="sport-balance p-4 text-center">
          <h5 class="text-white-50 text-uppercase mb-2">
            <i class="bi bi-wallet2 me-2"></i>{% trans "Solde Actuel" %}
          </h5>
          <div class="balance-amount">{{ user.kapanga_balance|floatformat:"2" }}</div>
          <p class="text-white-50 mt-2 mb-0">
            <small><i class="bi bi-currency-exchange me-1"></i>{% trans "Utilisez vos Ktap pour parier" %}</small>
          </p>
        </div>
        
        <!-- Actions -->
        <div class="card-body p-4">
          <div class="d-grid gap-3">
            <a
              href="{% url 'users:request_withdrawal' %}"
              class="sport-action-btn withdrawal-btn text-center text-decoration-none"
              aria-label="{% trans 'Demander un retrait de fonds' %}"
            >
              <i class="bi bi-cash-stack me-2"></i>{% trans "Demander un Retrait" %}
            </a>
            
            <div class="row g-2">
              <div class="col-6">
                <a
                  href="{% url 'users:profile_edit' %}"
                  class="sport-action-btn edit-btn w-100 text-center text-decoration-none d-block"
                  aria-label="{% trans 'Modifier le profil' %}"
                >
                  <i class="bi bi-pencil-square me-1"></i>{% trans "Modifier" %}
                </a>
              </div>
              <div class="col-6">
                <a
                  href="{% url 'users:withdrawal_history' %}"
                  class="sport-action-btn history-btn w-100 text-center text-decoration-none d-block"
                  aria-label="{% trans 'Voir l\'historique des retraits' %}"
                >
                  <i class="bi bi-clock-history me-1"></i>{% trans "Historique" %}
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Statistics Cards -->
    <div class="col-md-8">
      <div class="row g-3 mb-4">
        <div class="col-md-4">
          <div class="sport-stat-card">
            <i class="bi bi-trophy-fill" style="font-size: 2rem; color: var(--sport-yellow);"></i>
            <h4 class="mt-2 mb-1" style="color: var(--sport-text);">15</h4>
            <p class="text-muted text-uppercase mb-0" style="font-size: 0.8rem; font-weight: 600;">{% trans "Paris Gagnés" %}</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="sport-stat-card">
            <i class="bi bi-graph-up-arrow" style="font-size: 2rem; color: var(--sport-green);"></i>
            <h4 class="mt-2 mb-1" style="color: var(--sport-text);">87%</h4>
            <p class="text-muted text-uppercase mb-0" style="font-size: 0.8rem; font-weight: 600;">{% trans "Taux de Réussite" %}</p>
          </div>
        </div>
        <div class="col-md-4">
          <div class="sport-stat-card">
            <i class="bi bi-calendar-event" style="font-size: 2rem; color: var(--sport-blue);"></i>
            <h4 class="mt-2 mb-1" style="color: var(--sport-text);">23</h4>
            <p class="text-muted text-uppercase mb-0" style="font-size: 0.8rem; font-weight: 600;">{% trans "Jours Actifs" %}</p>
          </div>
        </div>
      </div>
      
      <!-- Transaction History -->
      <div class="sport-transaction-table">
        <div class="sport-table-header p-3 d-flex align-items-center justify-content-between">
          <div class="d-flex align-items-center">
            <i class="bi bi-journal-text me-2"></i>
            <h5 class="mb-0">{% trans "Historique des Transactions" %}</h5>
          </div>
          <div class="btn-group btn-group-sm" role="group" aria-label="Filtres de transactions">
            <button type="button" class="btn btn-outline-light active" aria-pressed="true">{% trans "Tout" %}</button>
            <button type="button" class="btn btn-outline-light" aria-pressed="false">{% trans "Dépôts" %}</button>
            <button type="button" class="btn btn-outline-light" aria-pressed="false">{% trans "Retraits" %}</button>
          </div>
        </div>
        
        <div class="p-3">
          <div class="table-responsive">
            <table class="table sport-table align-middle mb-0" role="table" aria-label="Historique des transactions">
              <thead class="table-light">
                <tr style="font-weight: 600; text-transform: uppercase; font-size: 0.85rem;">
                  <th scope="col"><i class="bi bi-calendar3 me-1" aria-hidden="true"></i>{% trans "Date" %}</th>
                  <th scope="col"><i class="bi bi-tag me-1" aria-hidden="true"></i>{% trans "Type" %}</th>
                  <th scope="col"><i class="bi bi-currency-exchange me-1" aria-hidden="true"></i>{% trans "Montant" %}</th>
                  <th scope="col"><i class="bi bi-check-circle me-1" aria-hidden="true"></i>{% trans "Statut" %}</th>
                </tr>
              </thead>
              <tbody>
                {% for transaction in transactions %}
                <tr>
                  <td style="font-weight: 500;">{{ transaction.date|date:"d/m/Y" }}</td>
                  <td>
                    <span class="badge" style="background: linear-gradient(135deg, var(--sport-blue) 0%, #1976d2 100%);">
                      {{ transaction.type }}
                    </span>
                  </td>
                  <td>
                    <span class="fw-bold {% if transaction.amount > 0 %}text-success{% else %}text-danger{% endif %}">
                      {% if transaction.amount > 0 %}+{% endif %}{{ transaction.amount|floatformat:"2" }} K
                    </span>
                  </td>
                  <td>
                    <span class="sport-badge" style="background: {% if transaction.status == 'completed' %}var(--sport-green){% elif transaction.status == 'pending' %}var(--sport-yellow){% else %}var(--sport-red){% endif %}; color: white;">
                      {{ transaction.status }}
                    </span>
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="4" class="text-center py-5">
                    <i class="bi bi-inbox" style="font-size: 3rem; color: #ccc;"></i>
                    <p class="text-muted mt-2 mb-0">Aucune transaction à afficher</p>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
